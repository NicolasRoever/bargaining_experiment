{{ block title }}
Make a deal
{{ endblock }}
{{ block content }}
<style>
    .mgslider-wrapper {
        border-spacing: 10px;
    }

    .mgslider-limit {
        width: 10%;
        min-width: 75px;
        height: 40px;
        margin: 100px;
        text-align: center;
        background: #eee;
        border: 1px solid #888;
    }

    .mgslider-limit, .mgslider-value {
        font-variant-numeric: tabular-nums;
    }

    .mgslider-before {
        height: 16px;
        width: 100%;
        background: #1e5bff;
    }

    .mgslider-feedback {
        -webkit-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .slider-container {
        display: flex;
        align-items: center;
    }

    .mgslider-wrapper {
        width: 95%;
        height: 50%; /* Adjust height as needed */
    }

    #submit {
        position: absolute; /* Position button absolutely */
        top: 16.6%; /* Adjust bottom spacing as needed */
        left: 75%; /* Position horizontally centered */
        transform: translateX(-50%); /* Center horizontally */
    }

    button#submit {
        background-color: #4CAF50; /* Green */
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin-left: 10px;
        border-radius: 5px;
        cursor: pointer;
    }

    button#submit:hover {
        background-color: #45a049; /* Darker Green */
    }

</style>

<p>
    This is a 2-player game. A seller and a buyer are negotiating for the price of
    [insert item here].
</p>
<p>
    You are the {{ player.role }}.
    Please negotiate with the {{ other_role }} below.
</p>

<table class="table">
    <tr>
        <th>Your current proposal</th>
        <td id="my-proposal">(none)</td>
        <td>
            <button type="button" id="btn-offer-slider" onclick="sendOffer()">Submit slider value</button>
        </td>
    </tr>
    <tr>
        <th>{{ other_role }} proposal</th>
        <td id="other-proposal">(none)</td>
        <td>
            <button type="button" id="btn-accept" onclick="sendAccept(this)" style="display: none">Accept</button>
        </td>
    </tr>
</table>

<div id="sliders_here"></div>

<script src="{{ static 'mgslider.js' }}"></script>

<script>

    $(document).ready(function (event) {
                slider1 = new mgslider("offer", 0, 10, 1);
                slider1.print(document.getElementById("sliders_here"));
                slider1.addSubmitter(function() {liveSend({'type':'propose', 'amount':slider1.getValue()})} )
                //slider1.recall(); // Optional line to remember value across errors
                //slider2 = new mgslider("number", 0, 10, 0.1);
                //slider2.print(document.getElementById("sliders_here"));
                //slider2.recall(); // Optional line to remember value across errors
            });

    
    let my_id = js_vars.my_id;
    let my_offer = document.getElementById('my_offer');
    let btnAccept = document.getElementById('btn-accept');
    let msgOtherProposal = document.getElementById('other-proposal');
    let msgMyProposal = document.getElementById('my-proposal');
    let btnSliderSubmit = document.getElementById('btn-offer-slider');


    let otherProposal;


    function sendOffer() {
        liveSend({'type': 'propose', 'amount': slider1.value()})
        //slider1.value() = ''; 
        //slider1.submit(); // slider cannot be moved after own offer is sent
        //btnSliderSubmit.click();
    }

    function sendAccept() {
        liveSend({'type': 'accept', 'amount': otherProposal})
    }

    function cu(amount) {
        return `${amount} points`;
    }

    function liveRecv(data) {
        if ('proposals' in data) {
            for (let [id_in_group, proposal] of data.proposals) {

                if (id_in_group === js_vars.my_id) {
                    msgMyProposal.innerHTML = cu(proposal)
                    slider1.disable();  // this works
                } else {
                    msgOtherProposal.innerHTML = cu(proposal);
                    otherProposal = proposal;
                    btnAccept.style.display = 'block';
                    slider1.enabled(); // does not work
                }
            }
        }
        if ('finished' in data) {
            document.getElementById('form').submit();
        }

        if ('latest_offer_by' in data){
            btnSliderSubmit.disabled = data.latest_offer_by == my_id;
        }
    }

    window.addEventListener('DOMContentLoaded', (event) => {
        liveSend({});
    });

</script>

{{ endblock }}